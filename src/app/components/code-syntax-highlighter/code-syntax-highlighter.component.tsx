import React, { useEffect, useState } from 'react';
import { Prism } from 'react-syntax-highlighter';
import { oneDark } from 'react-syntax-highlighter/dist/esm/styles/prism';
import clsx from 'clsx';
import type { CodeSyntaxHighlighterProps } from './code-syntax-highlighter.types';
import styles from './code-syntax-highlighter.module.scss';

export const CodeSyntaxHighlighter: React.FC<CodeSyntaxHighlighterProps> = ({ code }) => {
  const [isVisibleTooltip, setIsVisibleTooltip] = useState(false);

  const handleCopyClick = () => {
    navigator.clipboard.writeText(code).then(() => {
      setIsVisibleTooltip(true);
    });
  };

  useEffect(() => {
    let timeoutId: NodeJS.Timeout;

    if (isVisibleTooltip) {
      timeoutId = setTimeout(() => {
        setIsVisibleTooltip(false);
      }, 2000);
    }

    return () => {
      clearTimeout(timeoutId);
    };
  }, [isVisibleTooltip]);

  return (
    <div className={styles.container}>
      <div className={styles.copyContent}>
        <div
          className={clsx(styles.copyTooltip, {
            [styles.copyTooltipVisible]: isVisibleTooltip,
          })}
        >
          {/* TODO: add translation */}
          Copied
        </div>

        <button
          aria-label="Copy to clipboard"
          title="Copy to clipboard"
          className={clsx(styles.copyButton, { [styles.copyButtonVisible]: isVisibleTooltip })}
          onClick={handleCopyClick}
        >
          {/* TODO: add icon component */}
          <svg
            width="25"
            height="25"
            viewBox="0 0 25 25"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M10.0984 3.8897C9.78018 3.8897 9.47495 4.01613 9.24991 4.24117C9.02487 4.46621 8.89844 4.77144 8.89844 5.0897V5.6897C8.89844 5.84883 8.83522 6.00144 8.7227 6.11396C8.61018 6.22648 8.45757 6.2897 8.29844 6.2897C8.13931 6.2897 7.9867 6.22648 7.87417 6.11396C7.76165 6.00144 7.69844 5.84883 7.69844 5.6897V5.0897C7.69844 4.45318 7.95129 3.84273 8.40138 3.39264C8.85147 2.94255 9.46192 2.6897 10.0984 2.6897H10.6984C10.8576 2.6897 11.0102 2.75291 11.1227 2.86543C11.2352 2.97796 11.2984 3.13057 11.2984 3.2897C11.2984 3.44883 11.2352 3.60144 11.1227 3.71396C11.0102 3.82648 10.8576 3.8897 10.6984 3.8897H10.0984ZM8.89844 14.6897C8.89844 15.008 9.02487 15.3132 9.24991 15.5382C9.47495 15.7633 9.78018 15.8897 10.0984 15.8897H10.6984C10.8576 15.8897 11.0102 15.9529 11.1227 16.0654C11.2352 16.178 11.2984 16.3306 11.2984 16.4897C11.2984 16.6488 11.2352 16.8014 11.1227 16.914C11.0102 17.0265 10.8576 17.0897 10.6984 17.0897H10.0984C9.46192 17.0897 8.85147 16.8368 8.40138 16.3868C7.95129 15.9367 7.69844 15.3262 7.69844 14.6897V14.0897C7.69844 13.9306 7.76165 13.778 7.87417 13.6654C7.9867 13.5529 8.13931 13.4897 8.29844 13.4897C8.45757 13.4897 8.61018 13.5529 8.7227 13.6654C8.83522 13.778 8.89844 13.9306 8.89844 14.0897V14.6897ZM8.89844 8.0897C8.89844 7.93057 8.83522 7.77795 8.7227 7.66543C8.61018 7.55291 8.45757 7.4897 8.29844 7.4897C8.13931 7.4897 7.9867 7.55291 7.87417 7.66543C7.76165 7.77795 7.69844 7.93057 7.69844 8.0897V11.6897C7.69844 11.8488 7.76165 12.0014 7.87417 12.114C7.9867 12.2265 8.13931 12.2897 8.29844 12.2897C8.45757 12.2897 8.61018 12.2265 8.7227 12.114C8.83522 12.0014 8.89844 11.8488 8.89844 11.6897V8.0897ZM19.6984 3.8897C20.0167 3.8897 20.3219 4.01613 20.547 4.24117C20.772 4.46621 20.8984 4.77144 20.8984 5.0897V5.6897C20.8984 5.84883 20.9617 6.00144 21.0742 6.11396C21.1867 6.22648 21.3393 6.2897 21.4984 6.2897C21.6576 6.2897 21.8102 6.22648 21.9227 6.11396C22.0352 6.00144 22.0984 5.84883 22.0984 5.6897V5.0897C22.0984 4.45318 21.8456 3.84273 21.3955 3.39264C20.9454 2.94255 20.335 2.6897 19.6984 2.6897H19.0984C18.9393 2.6897 18.7867 2.75291 18.6742 2.86543C18.5617 2.97796 18.4984 3.13057 18.4984 3.2897C18.4984 3.44883 18.5617 3.60144 18.6742 3.71396C18.7867 3.82648 18.9393 3.8897 19.0984 3.8897H19.6984ZM19.6984 15.8897C20.0167 15.8897 20.3219 15.7633 20.547 15.5382C20.772 15.3132 20.8984 15.008 20.8984 14.6897V14.0897C20.8984 13.9306 20.9617 13.778 21.0742 13.6654C21.1867 13.5529 21.3393 13.4897 21.4984 13.4897C21.6576 13.4897 21.8102 13.5529 21.9227 13.6654C22.0352 13.778 22.0984 13.9306 22.0984 14.0897V14.6897C22.0984 15.3262 21.8456 15.9367 21.3955 16.3868C20.9454 16.8368 20.335 17.0897 19.6984 17.0897H19.0984C18.9393 17.0897 18.7867 17.0265 18.6742 16.914C18.5617 16.8014 18.4984 16.6488 18.4984 16.4897C18.4984 16.3306 18.5617 16.178 18.6742 16.0654C18.7867 15.9529 18.9393 15.8897 19.0984 15.8897H19.6984ZM21.4984 7.4897C21.3393 7.4897 21.1867 7.55291 21.0742 7.66543C20.9617 7.77795 20.8984 7.93057 20.8984 8.0897V11.6897C20.8984 11.8488 20.9617 12.0014 21.0742 12.114C21.1867 12.2265 21.3393 12.2897 21.4984 12.2897C21.6576 12.2897 21.8102 12.2265 21.9227 12.114C22.0352 12.0014 22.0984 11.8488 22.0984 11.6897V8.0897C22.0984 7.93057 22.0352 7.77795 21.9227 7.66543C21.8102 7.55291 21.6576 7.4897 21.4984 7.4897ZM13.0984 2.6897C12.9393 2.6897 12.7867 2.75291 12.6742 2.86543C12.5617 2.97796 12.4984 3.13057 12.4984 3.2897C12.4984 3.44883 12.5617 3.60144 12.6742 3.71396C12.7867 3.82648 12.9393 3.8897 13.0984 3.8897H16.6984C16.8576 3.8897 17.0102 3.82648 17.1227 3.71396C17.2352 3.60144 17.2984 3.44883 17.2984 3.2897C17.2984 3.13057 17.2352 2.97796 17.1227 2.86543C17.0102 2.75291 16.8576 2.6897 16.6984 2.6897H13.0984ZM12.4984 16.4897C12.4984 16.3306 12.5617 16.178 12.6742 16.0654C12.7867 15.9529 12.9393 15.8897 13.0984 15.8897H16.6984C16.8576 15.8897 17.0102 15.9529 17.1227 16.0654C17.2352 16.178 17.2984 16.3306 17.2984 16.4897C17.2984 16.6488 17.2352 16.8014 17.1227 16.914C17.0102 17.0265 16.8576 17.0897 16.6984 17.0897H13.0984C12.9393 17.0897 12.7867 17.0265 12.6742 16.914C12.5617 16.8014 12.4984 16.6488 12.4984 16.4897ZM5.29844 7.4897H6.49844V8.6897H5.29844C4.98018 8.6897 4.67495 8.81613 4.44991 9.04117C4.22487 9.26621 4.09844 9.57144 4.09844 9.8897V17.6897C4.09844 18.4853 4.41451 19.2484 4.97712 19.811C5.53973 20.3736 6.30279 20.6897 7.09844 20.6897H14.8984C15.2167 20.6897 15.5219 20.5633 15.747 20.3382C15.972 20.1132 16.0984 19.808 16.0984 19.4897V18.2897H17.2984V19.4897C17.2984 20.1262 17.0456 20.7367 16.5955 21.1868C16.1454 21.6368 15.535 21.8897 14.8984 21.8897H7.09844C5.98453 21.8897 4.91624 21.4472 4.12859 20.6595C3.34094 19.8719 2.89844 18.8036 2.89844 17.6897V9.8897C2.89844 9.25318 3.15129 8.64273 3.60138 8.19264C4.05147 7.74255 4.66192 7.4897 5.29844 7.4897V7.4897Z"
              fill="white"
            />
          </svg>
        </button>
      </div>

      <Prism language="javascript" style={oneDark} showLineNumbers>
        {code}
      </Prism>
    </div>
  );
};
